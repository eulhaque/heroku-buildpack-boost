#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e

BUILD_DIR=$1
CACHE_DIR=$2
source $(dirname $0)/../config.sh

function mktmpdir() {
  dir="$(mktemp -t $1-XXXX)"
  rm -rf "$dir"
  mkdir -p "$dir"
  echo "$dir"
}

function set-env() {
  echo "export $1=$2" >> $PROFILE_PATH
}

echo "-----> Installing Boost"

boost_lib_path="$BUILD_DIR/vendor/boost"
mkdir -p "$boost_lib_path"
VENDORED_BOOST="$(mktmpdir boost)"
curl "$BOOST_DOWNLOAD_URL" -L -s -o - | tar xzf - -C "$VENDORED_BOOST"
mv $VENDORED_BOOST/boost_* $VENDORED_BOOST
rm $VENDORED_BOOST/boost_*
cp -R $VENDORED_BOOST/* "$boost_lib_path"
set-env "CPLUS_INCLUDE_PATH" "$boost_lib_path:$CPLUS_INCLUDE_PATH"

echo "-----> Successfully installed Boost"
